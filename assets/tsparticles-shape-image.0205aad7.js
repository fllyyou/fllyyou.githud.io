import{v}from"./tsparticles-engine.62396409.js";const w=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;function p(a,e,r){const{svgData:o}=a;if(!o)return"";const t=v(e,r);if(o.includes("fill"))return o.replace(w,()=>t);const s=o.indexOf(">");return`${o.substring(0,s)} fill="${t}"${o.substring(s)}`}async function h(a){return new Promise(e=>{a.loading=!0;const r=new Image;a.element=r,r.addEventListener("load",()=>{a.loading=!1,e()}),r.addEventListener("error",()=>{a.element=void 0,a.error=!0,a.loading=!1,console.error(`Error tsParticles - loading image: ${a.source}`),e()}),r.src=a.source})}async function I(a){if(a.type!=="svg"){await h(a);return}a.loading=!0;const e=await fetch(a.source);e.ok||(console.error("Error tsParticles - Image not found"),a.error=!0),a.error||(a.svgData=await e.text()),a.loading=!1}function b(a,e,r,o){var t,s,n;const d=p(a,r,(s=(t=o.opacity)===null||t===void 0?void 0:t.value)!==null&&s!==void 0?s:1),l={color:r,data:Object.assign(Object.assign({},a),{svgData:d}),loaded:!1,ratio:e.width/e.height,replaceColor:(n=e.replaceColor)!==null&&n!==void 0?n:e.replace_color,source:e.src};return new Promise(i=>{const m=new Blob([d],{type:"image/svg+xml"}),c=URL||window.URL||window.webkitURL||window,f=c.createObjectURL(m),g=new Image;g.addEventListener("load",()=>{l.loaded=!0,l.element=g,i(l),c.revokeObjectURL(f)}),g.addEventListener("error",async()=>{c.revokeObjectURL(f);const u=Object.assign(Object.assign({},a),{error:!1,loading:!0});await h(u),l.loaded=!0,l.element=u.element,i(l)}),g.src=f})}class y{constructor(){this._images=[]}addImage(e,r){const o=this.getImages(e);o==null||o.images.push(r)}destroy(){this._images=[]}draw(e,r,o,t){var s;const n=r.image,d=n==null?void 0:n.element;if(!d)return;const l=(s=n==null?void 0:n.ratio)!==null&&s!==void 0?s:1,i={x:-o,y:-o};e.globalAlpha=t,e.drawImage(d,i.x,i.y,o*2,o*2/l),e.globalAlpha=1}getImages(e){const r=this._images.find(o=>o.id===e.id);return r||(this._images.push({id:e.id,images:[]}),this.getImages(e))}getSidesCount(){return 12}loadShape(e){if(e.shape!=="image"&&e.shape!=="images")return;const r=e.container,o=this.getImages(r).images,t=e.shapeData;o.find(n=>n.source===t.src)||this.loadImageShape(r,t).then(()=>{this.loadShape(e)})}particleInit(e,r){var o;if(r.shape!=="image"&&r.shape!=="images")return;const t=this.getImages(e).images,s=r.shapeData,n=r.getFillColor(),d=(o=s.replaceColor)!==null&&o!==void 0?o:s.replace_color,l=t.find(i=>i.source===s.src);if(!!l){if(l.loading){setTimeout(()=>{this.particleInit(e,r)});return}(async()=>{var i,m;let c;l.svgData&&n?c=await b(l,s,n,r):c={color:n,data:l,element:l.element,loaded:!0,ratio:s.width/s.height,replaceColor:d,source:s.src},c.ratio||(c.ratio=1);const f=(i=s.fill)!==null&&i!==void 0?i:r.fill,g=(m=s.close)!==null&&m!==void 0?m:r.close,u={image:c,fill:f,close:g};r.image=u.image,r.fill=u.fill,r.close=u.close})()}}async loadImageShape(e,r){var o;const t=r.src;if(!t)throw new Error("Error tsParticles - No image.src");try{const s={source:t,type:t.substring(t.length-3),error:!1,loading:!0};this.addImage(e,s),await(((o=r.replaceColor)!==null&&o!==void 0?o:r.replace_color)?I:h)(s)}catch{throw new Error(`tsParticles error - ${r.src} not found`)}}}async function C(a){const e=new y;await a.addShape("image",e),await a.addShape("images",e)}export{C as l};
